# Todo Tool 设计文档

> 本地 macOS Todo 应用 —— 简洁、高效、专注

---

## 1. 项目愿景

**一句话定位**：一个极简的本地 Todo 工具，帮助用户追踪每日任务，提升工作效率。

**核心原则**：
- 极简优先：功能克制，拒绝臃肿
- 本地优先：数据存储在本地，无需联网
- 快速启动：秒开秒用，零等待

---

## 2. 核心功能（MVP）

| 功能 | 描述 |
|------|------|
| 新增任务 | 快速添加待办事项 |
| 完成任务 | 一键标记任务完成 |
| 删除任务 | 移除不需要的任务 |
| 任务列表 | 查看当日所有任务（待办/已完成） |
| 数据持久化 | 本地存储，重启不丢失 |

---

## 3. 技术选型

- 前端：SwiftUI（macOS 原生，性能最优）
- 存储：JSON 文件（位于 `~/Library/Application Support/TodoTool/data.json`）
  - 写入：临时文件 + 原子替换（tmp → backup → rename）
  - 备份：每次成功写入保留 `.backup` 副本
  - 迁移：通过 `version` 字段判断，按需升级
- 架构：极简三层（View → TodoStore → JSON File）
- 窗口模式：单窗口实例；数据变更通过 `@Published` 自动刷新 UI
- 第三方依赖：**无**

---

## 4. 数据模型

```swift
struct Todo {
    let id: UUID                    // 唯一标识
    var title: String               // 非空，<= 200 字符
    var isCompleted: Bool           // 完成状态
    let createdAt: Date             // 创建时间（UTC ISO8601）
    var completedAt: Date?          // 完成时间（UTC ISO8601）
    var updatedAt: Date             // 最近修改时间
}
```

**存储格式（JSON）**：
```json
{
  "version": 1,
  "todos": [
    {
      "id": "uuid-string",
      "title": "完成设计文档",
      "isCompleted": true,
      "createdAt": "2025-01-09T09:00:00Z",
      "completedAt": "2025-01-09T14:30:00Z",
      "updatedAt": "2025-01-09T14:30:00Z"
    }
  ]
}
```

**规则**：
- 排序：按 `createdAt` 降序；已完成分组内同序。
- 编辑：标题可修改；空字符串不允许；删除需确认。
- 状态切换：更新 `updatedAt`，完成时写入 `completedAt`。

---

## 5. 交互与界面

**交互要点**
- 快捷键：⌘N 新建、Enter/Space 勾选、⌘⌫ 删除、Esc 取消编辑
- 空状态：展示引导文案与“新建”按钮
- 反馈：乐观更新；错误以 toast 提示并回滚；长操作显示轻量 loading
- 行为：单击勾选完成/未完成；双击或 Enter 进入行内编辑

```
+------------------------------------------+
|  Todo Tool                    [+ 新增]   |
+------------------------------------------+
|                                          |
|  📋 待办 (2)                             |
|  +------------------------------------+  |
|  | ○  写周报                          |  |
|  | ○  代码审查                        |  |
|  +------------------------------------+  |
|                                          |
|  ✅ 已完成 (1)                           |
|  +------------------------------------+  |
|  | ✓  完成设计文档          14:30     |  |
|  +------------------------------------+  |
|                                          |
+------------------------------------------+
```

---

## 6. 非功能要求

- 启动：首帧 < 200ms（冷启动）
- 持久化：写入使用临时文件 + 原子替换
  - 启动校验：JSON 解析验证
  - 损坏恢复：尝试读取 `.backup`；若不可恢复，创建空数据
- 安全：非沙盒模式下设置文件权限 600；App Sandbox 模式由系统管理；无需联网
- 备份：菜单项「文件 → 导出…」导出 JSON；崩溃恢复优先保证数据完整
- 测试：ViewModel/Storage 单测；基础 UI/UITest 覆盖新增/勾选/删除流；最小性能/内存基准

---

## 7. 目录结构

```
TodoTool/
├── TodoToolApp.swift      # 应用入口（~10 行）
├── Models/
│   └── Todo.swift         # 数据模型（~20 行）
├── Store/
│   └── TodoStore.swift    # 状态 + 持久化（~80 行）
├── Views/
│   ├── ContentView.swift  # 主界面（~50 行）
│   └── TodoRow.swift      # 单行视图（~30 行）
└── Info.plist

预估总代码量：~200 行
```

---

## 8. 未来演进（按需扩展）

| 优先级 | 功能 | 价值 |
|--------|------|------|
| P1 | 任务分类/标签 | 多维度组织任务 |
| P1 | 全局快捷键 / 菜单栏入口 | 任意位置快速唤起应用 |
| P2 | 每日统计 | 量化工作产出 |
| P2 | 提醒通知 | 防止遗忘重要任务 |
| P3 | 数据导出 | 备份与迁移 |
| P3 | 多日视图 | 回顾历史任务 |

---

## 9. 开发里程碑
 
```
Phase 1: 核心功能
├── 数据模型定义
├── 基础 UI 搭建
├── CRUD 操作实现
├── 本地持久化
└── 验收：CRUD + 持久化断电不丢数据；首帧 < 200ms；ViewModel/Storage 主路径单测
 
Phase 2: 体验优化
├── 快捷键绑定
├── 动画效果（基础过渡，帧率稳定）
├── 状态栏图标（可选）
└── 验收：快捷键在主视图可用；动画不卡顿；UITest 覆盖新增/勾选/删除流
 
Phase 3: 功能扩展
└── 按需添加 P1/P2 功能，记录迁移和验收标准
```
 
---
 
## 10. 设计哲学
 
> **「让数据像河流一样单向流动」**
 
- 单一数据源：ViewModel 持有唯一真相
- 不可变优先：状态变更通过明确的 action 触发
- 边界清晰：View 只负责展示，ViewModel 只负责逻辑
 
---
 
## 11. 新增能力（任务描述 + 增强日期选择）
- **任务描述**：Todo 增加 `description` 字段，支持多行文本；在列表标题下方以次级文字显示，行内编辑时可同时修改标题与描述；新增对话框使用多行输入框。
- **到期日期选择器**：保留「今天/明天/下周」快捷选项，新增图形化日历选择并支持清除；所有选定日期统一落在当天 23:59:59。
 
*文档版本: v1.2 | 更新时间: 2026-01-12*

